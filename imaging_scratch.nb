(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.1' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     47290,       1170]
NotebookOptionsPosition[     41606,       1089]
NotebookOutlinePosition[     42104,       1107]
CellTagsIndexPosition[     42061,       1104]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{
  RowBox[{"packageDirectory", "=", 
   RowBox[{"FileNameJoin", "@", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"NotebookDirectory", "[", "]"}], ",", 
      "\"\<mathematica_packages\\\\\>\""}], "}"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"outputDirectory", "=", 
    RowBox[{"FileNameJoin", "@", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"NotebookDirectory", "[", "]"}], ",", "\"\<output\\\\\>\""}], 
      "}"}]}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"Not", "@", 
     RowBox[{"MemberQ", "[", 
      RowBox[{"$Path", ",", "packageDirectory"}], "]"}]}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"AppendTo", "[", 
      RowBox[{"$Path", ",", "packageDirectory"}], "]"}], ";"}]}], 
   "\[IndentingNewLine]", "]"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"Get", "[", "\"\<ImageModeling.m\>\"", "]"}]}], "Input",
 CellChangeTimes->{{3.8109169439530396`*^9, 3.8109169583363657`*^9}},
 CellLabel->
  "In[597]:=",ExpressionUUID->"f246a61f-5ea7-43ed-8039-4d5b549a7d29"],

Cell[CellGroupData[{

Cell["Preliminaries", "Section",
 CellChangeTimes->{{3.8112516973143945`*^9, 
  3.811251701074501*^9}},ExpressionUUID->"1817c129-b2dc-4352-81a2-\
d7ccadd73d70"],

Cell[BoxData[
 RowBox[{
  RowBox[{"SetOptions", "[", 
   RowBox[{"ArrayPlot", ",", 
    RowBox[{"PlotLegends", "\[Rule]", "Automatic"}], ",", 
    RowBox[{"ColorFunction", "->", 
     RowBox[{"ColorData", "[", "\"\<CherryTones\>\"", "]"}]}]}], "]"}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.8112517045917373`*^9, 3.811251735816524*^9}, 
   3.8112547123168936`*^9, {3.811256703398385*^9, 3.811256706427908*^9}},
 CellLabel->
  "In[601]:=",ExpressionUUID->"11fbab7d-1641-4ff8-a08d-20b3383196f0"],

Cell["\<\
There is some freedom in defining the form of the fast Fourier transform. \
Here I choose the convention that is used in the Art of Scientific Computing \
(latest edition).\
\>", "Text",
 CellChangeTimes->{{3.811251822962039*^9, 
  3.8112518748781805`*^9}},ExpressionUUID->"ed229d32-f038-4273-a958-\
8813811b0f26"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"fourierParametersMATLAB", "=", 
   RowBox[{"{", 
    RowBox[{"1", ",", 
     RowBox[{"-", "1"}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fourierParametersAoC", "=", 
   RowBox[{"{", 
    RowBox[{"1", ",", "1"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetOptions", "[", 
   RowBox[{"Fourier", ",", 
    RowBox[{"FourierParameters", "\[Rule]", "fourierParametersAoC"}]}], "]"}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetOptions", "[", 
   RowBox[{"InverseFourier", ",", 
    RowBox[{"FourierParameters", "\[Rule]", "fourierParametersAoC"}]}], "]"}],
   ";"}]}], "Input",
 CellChangeTimes->{{3.811251877954384*^9, 3.8112519196725025`*^9}},
 CellLabel->
  "In[602]:=",ExpressionUUID->"13ad70de-88d0-4542-b980-951d9a7b9169"]
}, Open  ]],

Cell[CellGroupData[{

Cell["1D test", "Section",
 CellChangeTimes->{{3.8111672013118916`*^9, 
  3.8111672053945246`*^9}},ExpressionUUID->"a2a894a5-0bd3-4a00-8b7c-\
93bed2ea2d9b"],

Cell[BoxData[{
 RowBox[{"dim", "=", 
  RowBox[{"2", "^", "7"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"gauss1d", "[", 
    RowBox[{"x_", ",", "sigma_", ",", "mu_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"1", "/", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Sqrt", "[", 
         RowBox[{"2", "*", "Pi"}], "]"}], "*", "sigma"}], ")"}]}], ")"}], "*", 
    RowBox[{"Exp", "[", 
     RowBox[{
      RowBox[{"-", "0.5"}], 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"x", "-", "mu"}], ")"}], "/", "sigma"}], ")"}], "^", 
       "2"}]}], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"lambda", "=", "1."}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"min", "=", 
   RowBox[{
    RowBox[{"-", "20"}], "*", "lambda"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"max", "=", 
   RowBox[{"20", "*", "lambda"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"delta", "=", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"max", "-", "min"}], ")"}], "/", 
    RowBox[{"(", 
     RowBox[{"dim", "-", "1"}], ")"}]}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.81116720770199*^9, 3.8111672956235785`*^9}, {
   3.81116867258214*^9, 3.8111686954735527`*^9}, {3.811169098591364*^9, 
   3.8111691209035397`*^9}, {3.811178786776435*^9, 3.8111787880392294`*^9}, {
   3.811178995192889*^9, 3.811179009674099*^9}, 3.811179049992632*^9, 
   3.8111790834804373`*^9, 3.8111791265519986`*^9, {3.811179261896239*^9, 
   3.811179285464404*^9}, {3.811250804933669*^9, 3.8112508139696617`*^9}, 
   3.8112508885467353`*^9},
 CellLabel->
  "In[606]:=",ExpressionUUID->"d0b11fdd-a5c9-40f6-9c4c-775bbbadb33b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"arrayGauss1d", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"gauss1d", "[", 
      RowBox[{"x", ",", "1", ",", "0"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"x", ",", "min", ",", "max", ",", "delta"}], "}"}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.811168700277483*^9, 3.8111687188867645`*^9}, {
  3.81116875820868*^9, 3.811168779155925*^9}, {3.8111689943371305`*^9, 
  3.811169016952121*^9}, {3.8111690811758595`*^9, 3.811169090445361*^9}, {
  3.8111691411065226`*^9, 3.8111691418100853`*^9}, {3.8112508253492904`*^9, 
  3.811250826026909*^9}},
 CellLabel->
  "In[612]:=",ExpressionUUID->"9b9244a1-3234-4da3-aae5-dccd97c97fa1"],

Cell[BoxData[
 RowBox[{"ListPlot", "[", 
  RowBox[{
   RowBox[{"arrayGauss1d", "*", 
    RowBox[{"Sqrt", "[", 
     RowBox[{"2", "*", "Pi"}], "]"}]}], ",", 
   RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.811169144334936*^9, 3.811169157194251*^9}, {
  3.8111692371327972`*^9, 3.8111693210430965`*^9}, {3.8111697323202925`*^9, 
  3.8111697795339403`*^9}},
 CellLabel->
  "In[613]:=",ExpressionUUID->"b430f5c6-6060-4891-bd74-06de4317fdcf"],

Cell["\<\
Note that the ordering of the output of Fourier appears to be the zero \
frequency term first, then increasing positive frequency terms, followed by \
the most negative frequency term, working back on up to the smallest negative \
frequency term, e.g. 0, 1, 2, 3, \[PlusMinus]4,-3, -2, -1.\
\>", "Text",
 CellChangeTimes->{{3.811178061847298*^9, 3.8111781534953413`*^9}, {
  3.8111782324710703`*^9, 3.811178232727645*^9}, {3.811252100573621*^9, 
  3.8112521149732633`*^9}},ExpressionUUID->"55f73c60-acb4-4a9e-adbb-\
1b1dfc7473f6"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"arrayGauss1dFT", "=", 
   RowBox[{"delta", "*", 
    RowBox[{"Fourier", "[", "arrayGauss1d", "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"ListPlot", "[", 
  RowBox[{
   RowBox[{"Abs", "@", "arrayGauss1dFT"}], ",", 
   RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.811169792084008*^9, 3.8111698943829803`*^9}, {
   3.811178264455778*^9, 3.8111782656390533`*^9}, 3.8111789778641653`*^9, {
   3.811179034568017*^9, 3.8111790410165544`*^9}, {3.811179072280114*^9, 
   3.811179074246122*^9}, {3.8111791123759356`*^9, 3.8111791201694775`*^9}, {
   3.811179256904248*^9, 3.8111792570942783`*^9}, {3.811250628544612*^9, 
   3.811250658824735*^9}, {3.8112519718549614`*^9, 3.811252051274577*^9}},
 CellLabel->
  "In[614]:=",ExpressionUUID->"128831f8-3bbb-44b8-a075-90bf5b61f24b"],

Cell[BoxData[
 RowBox[{"ListPlot", "[", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"Abs", "@", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{
            RowBox[{"dim", "/", "2"}], "+", "1"}], ";;"}], "]"}], "]"}], "~", 
        "Join", "~", 
        RowBox[{"#", "[", 
         RowBox[{"[", 
          RowBox[{"1", ";;", 
           RowBox[{"dim", "/", "2"}]}], "]"}], "]"}]}], ")"}]}], "&"}], "[", 
    "arrayGauss1dFT", "]"}], ",", 
   RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.81117827939962*^9, 3.811178322343402*^9}, {
  3.811178372793332*^9, 3.8111784314477434`*^9}, {3.811179333639805*^9, 
  3.8111793344379015`*^9}, {3.811250748439087*^9, 3.8112507495978546`*^9}, {
  3.8112508741599817`*^9, 3.811250876276575*^9}, {3.811252070529272*^9, 
  3.8112520752533407`*^9}, {3.8112521476320324`*^9, 3.811252160214029*^9}, {
  3.8112522036681623`*^9, 3.811252247769368*^9}},
 CellLabel->
  "In[616]:=",ExpressionUUID->"9c2f65e6-d85e-4afd-a1dd-6993cc36de78"]
}, Closed]],

Cell[CellGroupData[{

Cell["2d test", "Section",
 CellChangeTimes->{{3.8112510474596553`*^9, 
  3.8112510487309165`*^9}},ExpressionUUID->"dfe1c6f6-64ef-4632-8167-\
e634337fa1a5"],

Cell[BoxData[{
 RowBox[{"dim", "=", 
  RowBox[{"2", "^", "8"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"lambda", "=", "1."}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"min", "=", 
   RowBox[{
    RowBox[{"-", "500"}], "*", "lambda"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"max", "=", 
   RowBox[{"500", "*", "lambda"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"delta", "=", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"max", "-", "min"}], ")"}], "/", 
    RowBox[{"(", 
     RowBox[{"dim", "-", "1"}], ")"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"objectWidth", "=", 
   RowBox[{"50", "*", "lambda"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Print", "[", 
   RowBox[{"\"\<Spatial pixel size [lambda] = \>\"", "<>", 
    RowBox[{"ToString", "[", "delta", "]"}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Print", "[", 
   RowBox[{"\"\<Array size: \>\"", "<>", 
    RowBox[{"ToString", "[", 
     RowBox[{"dim", "^", "2"}], "]"}]}], "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.8109169825626945`*^9, 3.8109170199049525`*^9}, 
   3.810917565105348*^9, {3.810917683826516*^9, 3.8109177289434834`*^9}, {
   3.8109178181448355`*^9, 3.810917838097311*^9}, 3.8109189101116867`*^9, 
   3.8109190557913723`*^9, {3.8110908422339144`*^9, 3.8110909422483606`*^9}, {
   3.811091081861897*^9, 3.8110911221001925`*^9}, {3.81109115797729*^9, 
   3.8110911955296087`*^9}, {3.811091274505765*^9, 3.8110913231425*^9}, {
   3.811091661095231*^9, 3.811091697560711*^9}, {3.8112510595994186`*^9, 
   3.8112510875488586`*^9}, {3.8112511245153575`*^9, 3.811251150660591*^9}, {
   3.811255231542568*^9, 3.8112552628780355`*^9}, 3.811256433705886*^9, 
   3.8112569529496937`*^9, {3.8112643893287334`*^9, 3.8112644529910526`*^9}, 
   3.81126470090856*^9, 3.811528821284066*^9, 3.8116907824867525`*^9, {
   3.8116978419223022`*^9, 3.8116978697463813`*^9}, {3.811699175055812*^9, 
   3.8116991883877344`*^9}},
 CellLabel->
  "In[698]:=",ExpressionUUID->"b6ae6e97-a5d6-40fe-9370-956879952daa"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(", 
   RowBox[{
    RowBox[{"targetArrayGauss", "=", 
     RowBox[{"Parallelize", "@", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Exp", "[", 
         RowBox[{
          RowBox[{"-", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"x", "^", "2"}], "+", 
             RowBox[{"y", "^", "2"}]}], ")"}]}], "/", 
          RowBox[{"(", 
           RowBox[{"objectWidth", "^", "2"}], ")"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"x", ",", "min", ",", "max", ",", "delta"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"y", ",", "min", ",", "max", ",", "delta"}], "}"}]}], 
       "]"}]}]}], ";"}], ")"}], "//", "Timing"}]], "Input",
 CellChangeTimes->{{3.8109170321791124`*^9, 3.8109170940968857`*^9}, {
   3.8109171896963263`*^9, 3.8109172332644978`*^9}, 3.810917277664627*^9, {
   3.8109173215218267`*^9, 3.8109173262409625`*^9}, {3.810917363264367*^9, 
   3.8109174974604254`*^9}, {3.810917535409768*^9, 3.81091754350421*^9}, 
   3.8109176626575913`*^9, {3.8109177010254602`*^9, 3.8109177976634007`*^9}, {
   3.81091861348847*^9, 3.8109186146222625`*^9}, {3.811090949099079*^9, 
   3.8110909516254797`*^9}, {3.8112511569141026`*^9, 3.811251159817298*^9}, {
   3.8112511991197257`*^9, 3.811251218379037*^9}, {3.8112515995049286`*^9, 
   3.8112516024799805`*^9}, {3.811251752727028*^9, 3.8112518057003155`*^9}, {
   3.811255276534726*^9, 3.8112553377063103`*^9}, {3.8112564522675943`*^9, 
   3.811256498760191*^9}, {3.811256611441286*^9, 3.8112566119226737`*^9}, {
   3.8115280529026203`*^9, 3.8115280817798634`*^9}},
 CellLabel->
  "In[625]:=",ExpressionUUID->"3a649f95-d095-471b-bb7e-261ba8c17efc"],

Cell[BoxData[
 RowBox[{"ArrayPlot", "[", "targetArrayGauss", "]"}]], "Input",
 CellChangeTimes->{{3.811256631386624*^9, 3.8112566321593924`*^9}, {
  3.811256665448781*^9, 3.8112567213514557`*^9}},
 CellLabel->
  "In[626]:=",ExpressionUUID->"52681d83-ad74-4542-a746-c0ae4441ef15"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"(", 
   RowBox[{"targetArrayDot", "=", 
    RowBox[{"Parallelize", "@", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"Boole", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"x", "^", "2"}], "+", 
           RowBox[{"y", "^", "2"}]}], ")"}], "\[LessEqual]", 
         RowBox[{"objectWidth", "^", "2"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"x", ",", "min", ",", "max", ",", "delta"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"y", ",", "min", ",", "max", ",", "delta"}], "}"}]}], 
      "]"}]}]}], ")"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"ArrayPlot", "[", "%", "]"}], "\[IndentingNewLine]", 
 RowBox[{"Dimensions", "@", "targetArrayDot"}]}], "Input",
 CellChangeTimes->{{3.8109185986709085`*^9, 3.8109186563039465`*^9}, {
   3.810918753135849*^9, 3.8109187774706593`*^9}, {3.810918904222228*^9, 
   3.8109189333449826`*^9}, 3.81091898009624*^9, {3.8109190306081486`*^9, 
   3.8109190512961063`*^9}, 3.8109190915360117`*^9, {3.811090961562971*^9, 
   3.8110909876568995`*^9}, {3.8112512476430445`*^9, 3.811251253163492*^9}, {
   3.8112516085557003`*^9, 3.811251611642959*^9}, {3.8112522738749056`*^9, 
   3.81125228729664*^9}, {3.811256727944202*^9, 3.8112567306345053`*^9}},
 CellLabel->
  "In[627]:=",ExpressionUUID->"c817f662-5b5e-4036-a19a-3a4a9e68a2b1"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Fourier transforms", "Chapter",
 CellChangeTimes->{{3.8110906578482203`*^9, 
  3.811090666233122*^9}},ExpressionUUID->"ebcfece4-d757-4304-9540-\
784119719bcc"],

Cell[BoxData[
 RowBox[{"ArrayPlot", "@", 
  RowBox[{"Abs", "@", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"delta", "^", "2"}], "*", 
     RowBox[{"Fourier", "[", "targetArrayDot", "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.810917941105056*^9, 3.8109179496017265`*^9}, {
   3.810918113713009*^9, 3.8109181237595997`*^9}, {3.8109183360483055`*^9, 
   3.8109183400326495`*^9}, 3.810918382960951*^9, {3.8109184341438203`*^9, 
   3.810918439712388*^9}, {3.8109191039360514`*^9, 3.810919123567666*^9}, {
   3.810919371438938*^9, 3.8109194006551905`*^9}, {3.8109194475676455`*^9, 
   3.810919455837825*^9}, {3.8109196513746247`*^9, 3.8109196634697723`*^9}, {
   3.8110923718460693`*^9, 3.811092390630977*^9}, {3.8112513090413575`*^9, 
   3.811251348004429*^9}, {3.811251440240013*^9, 3.811251449988181*^9}, {
   3.8112514967366447`*^9, 3.811251497859171*^9}, {3.8112523033481493`*^9, 
   3.8112523185225096`*^9}},
 CellLabel->
  "In[630]:=",ExpressionUUID->"3f7c16fb-bebe-455d-8dc8-33428fa0b67a"],

Cell[BoxData[
 RowBox[{"ArrayPlot", "[", 
  RowBox[{
   RowBox[{"Abs", "@", 
    RowBox[{"Transpose", "[", 
     RowBox[{"RotateLeft", "[", 
      RowBox[{
       RowBox[{"Transpose", "[", 
        RowBox[{"RotateLeft", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"delta", "^", "2"}], "*", 
           RowBox[{"Fourier", "[", 
            RowBox[{"targetArrayDot", ",", 
             RowBox[{
             "FourierParameters", "\[Rule]", "fourierParametersAoC"}]}], 
            "]"}]}], ",", 
          RowBox[{"dim", "/", "2"}]}], "]"}], "]"}], ",", 
       RowBox[{"dim", "/", "2"}]}], "]"}], "]"}]}], ",", 
   RowBox[{"PlotLegends", "\[Rule]", "Automatic"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.810919668110839*^9, 3.810919669613078*^9}, {
  3.810919778765026*^9, 3.8109198845412674`*^9}, {3.8112513817471266`*^9, 
  3.811251385456155*^9}, {3.8112514564323916`*^9, 3.8112514720351524`*^9}, {
  3.811251516621734*^9, 3.8112515289414167`*^9}},
 CellLabel->
  "In[631]:=",ExpressionUUID->"b60df23a-2a0d-475a-a29d-e0f469c7fbec"],

Cell[BoxData[
 RowBox[{"ArrayPlot", "[", 
  RowBox[{"Abs", "@", 
   RowBox[{"rearrange2DFourierArray", "[", 
    RowBox[{
     RowBox[{"delta", "^", "2"}], "*", 
     RowBox[{"Fourier", "@", "targetArrayGauss"}]}], "]"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.81091994961277*^9, 3.8109199504638014`*^9}, {
  3.811251405990193*^9, 3.8112514084837894`*^9}, {3.8112515399185076`*^9, 
  3.8112515747163563`*^9}, {3.81125237132016*^9, 3.8112524594856806`*^9}},
 CellLabel->
  "In[632]:=",ExpressionUUID->"b2f32056-fa87-41cb-aff4-cfd9daac8822"],

Cell[BoxData[
 RowBox[{"ArrayPlot", "@", 
  RowBox[{"Abs", "@", 
   RowBox[{"InverseFourier", "@", 
    RowBox[{"Fourier", "@", "targetArrayGauss"}]}]}]}]], "Input",
 CellChangeTimes->{{3.8109200126865673`*^9, 3.810920042287176*^9}},
 CellLabel->
  "In[633]:=",ExpressionUUID->"b8fdd1a0-78ed-4154-a4bd-6ea309d1aaa4"]
}, Open  ]],

Cell[CellGroupData[{

Cell["transfer function", "Chapter",
 CellChangeTimes->{{3.8110906765038238`*^9, 3.8110906787448235`*^9}, 
   3.811093247604026*^9},ExpressionUUID->"4e412f85-2869-4b80-a8bc-\
0fe1517e6d5b"],

Cell["\<\
Note that this may have to propagate the field over a millimeter to fully \
encompass the cloud, which is thousands of wavelengths.\
\>", "Text",
 CellChangeTimes->{{3.8112549554596415`*^9, 
  3.8112550057725525`*^9}},ExpressionUUID->"6ac2ce8b-702b-49eb-85f3-\
d36097ebf91d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"deltaf", "=", 
   RowBox[{"1", "/", 
    RowBox[{"(", 
     RowBox[{"dim", "*", "delta"}], ")"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"k0p", "=", 
   RowBox[{"2", "*", 
    RowBox[{"Pi", "/", "lambda"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"fNyquist", "=", 
  RowBox[{"1", "/", 
   RowBox[{"(", 
    RowBox[{"2", "*", "delta"}], ")"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fmin", "=", 
   RowBox[{"-", "fNyquist"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fmax", "=", 
   RowBox[{"fNyquist", "-", "deltaf"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.811090682712625*^9, 3.8110908036879964`*^9}, {
   3.811091387606988*^9, 3.811091388536168*^9}, 3.8110916423130217`*^9, {
   3.8110917101662445`*^9, 3.8110917667118206`*^9}, {3.8112511325299635`*^9, 
   3.811251133558004*^9}, {3.81125335396375*^9, 3.8112533986911592`*^9}, {
   3.811253753945819*^9, 3.811253800884659*^9}, {3.8112538490042324`*^9, 
   3.811253898558441*^9}, {3.8112541236267433`*^9, 3.811254125896349*^9}, {
   3.8116912912349496`*^9, 3.8116912975218*^9}},
 CellLabel->
  "In[634]:=",ExpressionUUID->"4d081cd8-00ea-4431-8679-34f6be2ac833"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"transferArray", "[", "delz_", "]"}], ":=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"opticalTransferFunction", "[", 
      RowBox[{"delz", ",", "k0p", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"2", "*", "Pi", "*", "fx"}], ",", 
         RowBox[{"2", "*", "Pi", "*", "fy"}]}], "}"}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"fx", ",", "fmin", ",", "fmax", ",", "deltaf"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"fy", ",", "fmin", ",", "fmax", ",", "deltaf"}], "}"}]}], 
    "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.811090682712625*^9, 3.8110908036879964`*^9}, {
  3.811091400374424*^9, 3.811091412360658*^9}, {3.811091746327524*^9, 
  3.8110917619596825`*^9}, {3.8110920149838285`*^9, 3.811092016360359*^9}, {
  3.8112538175481024`*^9, 3.8112538409183245`*^9}, {3.8112539069302464`*^9, 
  3.8112539300541654`*^9}, {3.8112540607504835`*^9, 3.811254077702013*^9}},
 CellLabel->
  "In[639]:=",ExpressionUUID->"f5667b32-d3de-4dd9-a8ba-f1be2de6b3d5"],

Cell[BoxData[
 RowBox[{"ArrayPlot", "[", 
  RowBox[{
   RowBox[{"Arg", "@", 
    RowBox[{"transferArray", "[", 
     RowBox[{"2500", "/", "Pi"}], "]"}]}], ",", 
   RowBox[{"ColorFunction", "\[Rule]", 
    RowBox[{"ColorData", "[", "\"\<TemperatureMap\>\"", "]"}]}]}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.8110919903587227`*^9, 3.811092086421173*^9}, {
   3.811092193975771*^9, 3.811092240167879*^9}, {3.811254052135045*^9, 
   3.8112540851709056`*^9}, {3.8112547450859876`*^9, 
   3.8112547454472723`*^9}, {3.811254789626603*^9, 3.811254789978166*^9}, {
   3.811255025743379*^9, 3.8112550263007545`*^9}, {3.8112552013378296`*^9, 
   3.811255201418793*^9}, {3.8112567645360727`*^9, 3.811256792235068*^9}, 
   3.811256830365551*^9, {3.811691707731497*^9, 3.8116917087525983`*^9}, {
   3.811698521780317*^9, 3.811698524481298*^9}},
 CellLabel->
  "In[681]:=",ExpressionUUID->"df5b85fe-a851-48a2-a9ac-d52062affbaf"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"psfPutra", "[", 
    RowBox[{"delz_", ",", "k0_", ",", "rPerp_"}], "]"}], ":=", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"x", "=", 
        RowBox[{"rPerp", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{"y", "=", 
        RowBox[{"rPerp", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Return", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"k0", "/", "delz"}], ")"}], "*", 
        RowBox[{"Exp", "[", 
         RowBox[{"I", "*", "Pi", "*", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "1"}], "/", "2"}], "+", 
            RowBox[{"k0", "*", 
             RowBox[{
              RowBox[{"rPerp", ".", "rPerp"}], "/", "delz"}]}]}], ")"}]}], 
         "]"}]}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"psfGoodman", "[", 
    RowBox[{"delz_", ",", "k0_", ",", "rPerp_"}], "]"}], ":=", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Return", "[", 
       RowBox[{"k0", "*", 
        RowBox[{
         RowBox[{"Exp", "[", 
          RowBox[{"I", "*", "k0", 
           RowBox[{"(", 
            RowBox[{"delz", "+", 
             RowBox[{
              RowBox[{"rPerp", ".", "rPerp"}], "/", 
              RowBox[{"(", 
               RowBox[{"2", "*", "delz"}], ")"}]}]}], ")"}]}], "]"}], "/", 
         RowBox[{"(", 
          RowBox[{"I", "*", "2", "*", "Pi", "*", "delz"}], ")"}]}]}], "]"}], 
      ";"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"psfArray", "[", "delz_", "]"}], ":=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"psfGoodman", "[", 
     RowBox[{"delz", ",", "k0p", ",", 
      RowBox[{"{", 
       RowBox[{"x", ",", "y"}], "}"}]}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"x", ",", "min", ",", "max", ",", "delta"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"y", ",", "min", ",", "max", ",", "delta"}], "}"}]}], 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.8116908846619854`*^9, 3.811691225059164*^9}, {
  3.8116913068798075`*^9, 3.811691312415983*^9}, {3.8116947571934876`*^9, 
  3.811694779754206*^9}, {3.8116948172416477`*^9, 3.8116949594319515`*^9}},
 CellLabel->
  "In[641]:=",ExpressionUUID->"914f1455-1a8d-4cad-8073-a46aa501f017"],

Cell[BoxData[
 RowBox[{"Dimensions", "@", 
  RowBox[{"psfArray", "[", "50", "]"}]}]], "Input",
 CellChangeTimes->{{3.8116914456506586`*^9, 3.811691474594322*^9}},
 CellLabel->
  "In[644]:=",ExpressionUUID->"614831fd-ac1b-401f-b001-ca7593aad677"],

Cell[BoxData[{
 RowBox[{"ArrayPlot", "[", 
  RowBox[{
   RowBox[{"Arg", "@", 
    RowBox[{"psfArray", "[", "1000", "]"}]}], ",", 
   RowBox[{"ColorFunction", "\[Rule]", 
    RowBox[{"ColorData", "[", "\"\<TemperatureMap\>\"", "]"}]}]}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"ArrayPlot", "@", 
  RowBox[{"Abs", "@", 
   RowBox[{"psfArray", "[", "1000", "]"}]}]}]}], "Input",
 CellChangeTimes->{{3.811691327570247*^9, 3.8116913743866587`*^9}, {
  3.811691409315533*^9, 3.8116914113300705`*^9}, {3.8116914780039473`*^9, 
  3.81169147809595*^9}, {3.811691530980133*^9, 3.8116916156173496`*^9}, {
  3.8116949693245406`*^9, 3.81169502485913*^9}},
 CellLabel->
  "In[645]:=",ExpressionUUID->"1fae7e7f-972c-4e6b-a346-ff12a497a2f8"],

Cell[BoxData[
 RowBox[{"Dimensions", "@", 
  RowBox[{"transferArray", "[", "1", "]"}]}]], "Input",
 CellChangeTimes->{{3.8112540941867466`*^9, 3.811254100305799*^9}},
 CellLabel->
  "In[647]:=",ExpressionUUID->"1a28ecdb-a0ab-4659-996a-b775edc73709"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"propField", "[", 
    RowBox[{"delz_", ",", "target_"}], "]"}], ":=", 
   RowBox[{"(*", 
    RowBox[{"deltaf", "^", "2"}], "**)"}], 
   RowBox[{"(*", 
    RowBox[{"rearrange2DFourierArray", "@"}], "*)"}], 
   RowBox[{"InverseFourier", "[", 
    RowBox[{
     RowBox[{"transferArray", "[", "delz", "]"}], "*", 
     RowBox[{"rearrange2DFourierArray", "@", 
      RowBox[{"Fourier", "@", "target"}]}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.811091787751507*^9, 3.811091849796298*^9}, {
  3.8110919099882264`*^9, 3.811091927161831*^9}, {3.8112542828939514`*^9, 
  3.811254287144176*^9}, {3.811527263798661*^9, 3.811527303523917*^9}, {
  3.811527404871413*^9, 3.811527425733842*^9}, {3.811527503638692*^9, 
  3.8115275153360806`*^9}, {3.8116950490828185`*^9, 3.8116951003133736`*^9}, {
  3.811695159785349*^9, 3.8116951616245584`*^9}, {3.8116953329821997`*^9, 
  3.81169533373632*^9}, {3.811695653802095*^9, 3.811695674423651*^9}, {
  3.8116957697354345`*^9, 3.811695769990958*^9}, {3.811695924905752*^9, 
  3.811695976474304*^9}, {3.8116975656724977`*^9, 3.811697567204928*^9}},
 CellLabel->
  "In[648]:=",ExpressionUUID->"dadbe895-2a7c-4e8d-b233-9a5a9bdf89b9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"deltazp", "=", 
   RowBox[{"2500", "/", "Pi"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"ArrayPlot", "[", 
  RowBox[{
   RowBox[{"Abs", "@", 
    RowBox[{"propField", "[", 
     RowBox[{"deltazp", ",", "targetArrayGauss"}], "]"}]}], ",", 
   RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}]}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Max", "@", 
  RowBox[{"Abs", "@", 
   RowBox[{"propField", "[", 
    RowBox[{"deltazp", ",", "targetArrayGauss"}], "]"}]}]}]}], "Input",
 CellChangeTimes->{{3.8110919298510785`*^9, 3.8110919606154084`*^9}, {
   3.8110923165489297`*^9, 3.811092331919445*^9}, {3.811254149531272*^9, 
   3.8112542383655343`*^9}, {3.8112543969273586`*^9, 3.811254447307475*^9}, {
   3.811255033999357*^9, 3.8112551695796127`*^9}, {3.811257909527969*^9, 
   3.811257932484986*^9}, {3.811258000626397*^9, 3.811258003403909*^9}, {
   3.8112580356080065`*^9, 3.8112580480422835`*^9}, {3.8115274385834236`*^9, 
   3.8115274568712454`*^9}, {3.811527521943516*^9, 3.811527552423089*^9}, 
   3.811528424293814*^9, {3.811528456404787*^9, 3.811528493684312*^9}, {
   3.811528632565053*^9, 3.811528665203244*^9}, {3.811698478627683*^9, 
   3.8116984791376715`*^9}},
 CellLabel->
  "In[678]:=",ExpressionUUID->"ee60dd30-c5ab-4d42-a371-a99ece33f1f6"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"propFieldGoodman", "[", 
    RowBox[{"delz_", ",", "target_"}], "]"}], ":=", 
   RowBox[{"(*", 
    RowBox[{"rearrange2DFourierArray", "@"}], "*)"}], 
   RowBox[{"ListConvolve", "[", 
    RowBox[{
     RowBox[{"psfArray", "[", "delz", "]"}], ",", "target", ",", "1"}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"deltazp", "=", 
   RowBox[{"6000", "/", "Pi"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"ArrayPlot", "[", 
  RowBox[{
   RowBox[{"Abs", "@", 
    RowBox[{"propFieldGoodman", "[", 
     RowBox[{"deltazp", ",", "targetArrayGauss"}], "]"}]}], ",", 
   RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.8116953513071976`*^9, 3.8116953963632493`*^9}, {
  3.8116975709495506`*^9, 3.811697572310257*^9}, {3.8116976129933295`*^9, 
  3.8116976238761253`*^9}, {3.8116976610301447`*^9, 3.811697744821261*^9}, {
  3.811698018837365*^9, 3.811698021572258*^9}, {3.811698057010149*^9, 
  3.8116980659713116`*^9}, {3.811698115268855*^9, 3.811698122482739*^9}, {
  3.8116981701011457`*^9, 3.811698191955612*^9}},
 CellLabel->
  "In[652]:=",ExpressionUUID->"c0127f46-06f1-4f6f-a4d7-36b1c4e435a1"],

Cell[BoxData[
 RowBox[{"propFieldGoodman", "[", 
  RowBox[{"deltazp", ",", "targetArrayGauss"}], "]"}]], "Input",
 CellLabel->
  "In[655]:=",ExpressionUUID->"c3102b0a-3b7f-459b-adbb-f49ce5519a68"],

Cell[BoxData[
 RowBox[{"ListConvolve", "[", 
  RowBox[{
   RowBox[{"psfArray", "[", "deltazp", "]"}], ",", "targetArrayGauss", ",", 
   "1"}], "]"}]], "Input",
 CellChangeTimes->{{3.8116955192752457`*^9, 3.811695602100913*^9}, {
  3.8116956378963437`*^9, 3.8116956380532317`*^9}},
 CellLabel->
  "In[656]:=",ExpressionUUID->"6dafbc58-cbe8-485c-a39a-40dc8a199daf"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.8115284311925783`*^9, 3.8115284542785883`*^9}},
 CellLabel->
  "In[657]:=",ExpressionUUID->"1dd9d9c9-334e-41d9-95ed-d81dfc69bfda"]
}, Open  ]],

Cell[CellGroupData[{

Cell["absorption function", "Chapter",
 CellChangeTimes->{{3.811093252468769*^9, 
  3.8110932554617324`*^9}},ExpressionUUID->"8e55635b-eb9f-4a88-a2ec-\
ba5b485009b2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"zdim", "=", "dim"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"sigma0", "=", 
  RowBox[{"6", "*", 
   RowBox[{"Pi", "/", 
    RowBox[{"k0p", "^", "2"}]}]}]}]}], "Input",
 CellChangeTimes->{{3.8110933511113844`*^9, 3.8110933603251257`*^9}, {
  3.811094454898966*^9, 3.8110944899528837`*^9}, {3.811258623763097*^9, 
  3.8112586410369005`*^9}},
 CellLabel->
  "In[658]:=",ExpressionUUID->"241007ce-55a5-4f57-a8e0-c91950a2d829"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"cloudWidth", "=", 
   RowBox[{"10", "*", "lambda"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"z0Cloud", "=", "0"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"maxOD", "=", "1"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"rho", "[", 
    RowBox[{"x_", ",", "y_", ",", "z_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"maxOD", "/", "sigma0"}], ")"}], "/", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Sqrt", "[", 
         RowBox[{"2", "*", "Pi"}], "]"}], "*", "cloudWidth"}], ")"}]}], ")"}],
     "*", 
    RowBox[{"Exp", "[", 
     RowBox[{
      RowBox[{"-", "0.5"}], "*", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"z", "-", "z0Cloud"}], ")"}], "/", "cloudWidth"}], ")"}], 
       "^", "2"}]}], "]"}], "*", 
    RowBox[{"Exp", "[", 
     RowBox[{
      RowBox[{"-", "0.5"}], "*", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"y", "/", "cloudWidth"}], ")"}], "^", "2"}]}], "]"}], "*", 
    RowBox[{"Exp", "[", 
     RowBox[{
      RowBox[{"-", "0.5"}], "*", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"x", "/", "cloudWidth"}], ")"}], "^", "2"}]}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"rho", "[", 
  RowBox[{"0", ",", "0", ",", "0"}], "]"}]}], "Input",
 CellChangeTimes->{{3.811264253957927*^9, 3.811264345380898*^9}, {
   3.811264482944419*^9, 3.8112646142549443`*^9}, {3.8112646541973352`*^9, 
   3.811264662589935*^9}, {3.811265082152926*^9, 3.8112650823205585`*^9}, {
   3.8112651611549954`*^9, 3.8112651638471775`*^9}, {3.811265251473973*^9, 
   3.8112652773364305`*^9}, 3.811265355055832*^9, {3.811265742954144*^9, 
   3.811265745349965*^9}},
 CellLabel->
  "In[660]:=",ExpressionUUID->"44a719de-cb6e-4bcc-affa-7503033d4ff2"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
    RowBox[{"chi", "[", 
     RowBox[{
     "x_", ",", "y_", ",", "z_", ",", "fieldIntensity_", ",", "delta_", ",", 
      "linewidth_", ",", "saturationIntensity_"}], "]"}], ":=", 
    RowBox[{"Module", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"rInt", "=", 
         RowBox[{"fieldIntensity", "/", "saturationIntensity"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"rDet", "=", 
         RowBox[{"2", "*", 
          RowBox[{"delta", "/", "linewidth"}]}]}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Return", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"sigma0", "/", "k0p"}], ")"}], "*", 
         RowBox[{"(", 
          RowBox[{"I", "-", "rDet"}], ")"}], "*", 
         RowBox[{
          RowBox[{"rho", "[", 
           RowBox[{"x", ",", "y", ",", "z"}], "]"}], "/", 
          RowBox[{"(", 
           RowBox[{"1", "+", "rInt", "+", 
            RowBox[{"rDet", "^", "2"}]}], ")"}]}]}], "]"}], ";"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "*)"}]], "Input",
 CellChangeTimes->{{3.811515675280568*^9, 3.8115156831979504`*^9}, {
   3.81151593689412*^9, 3.8115162477249994`*^9}, 3.811517337463169*^9},
 CellLabel->
  "In[665]:=",ExpressionUUID->"75465931-610e-48ac-ab20-abf1b7f70ac7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"chiArray", "=", 
   RowBox[{"Parallelize", "@", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"I", "*", 
         RowBox[{"sigma0", "/", "k0p"}]}], ")"}], "*", 
       RowBox[{"rho", "[", 
        RowBox[{"x", ",", "y", ",", "z"}], "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"x", ",", "min", ",", "max", ",", "delta"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"y", ",", "min", ",", "max", ",", "delta"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"z", ",", "min", ",", "max", ",", "delta"}], "}"}]}], 
     "]"}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.8110932612567115`*^9, 3.8110933106935787`*^9}, {
   3.8110933672242765`*^9, 3.8110933812380724`*^9}, 3.8110942639570246`*^9, {
   3.811094434707587*^9, 3.8110944362754097`*^9}, {3.811094506835557*^9, 
   3.8110945105487013`*^9}, {3.811256897181534*^9, 3.8112569146329226`*^9}, {
   3.8112646763571568`*^9, 3.811264686200079*^9}, {3.8112659277092137`*^9, 
   3.811265943521806*^9}},
 CellLabel->
  "In[666]:=",ExpressionUUID->"e1162aa8-6f1f-4187-b0c4-c3525a41db36"],

Cell[BoxData[
 RowBox[{"chiArray", "[", 
  RowBox[{"[", 
   RowBox[{
    RowBox[{"dim", "/", "2"}], ",", 
    RowBox[{"dim", "/", "2"}], ",", 
    RowBox[{"dim", "/", "2"}]}], "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.8112651423952312`*^9, 3.811265214401116*^9}},
 CellLabel->
  "In[667]:=",ExpressionUUID->"f8542fd5-20ec-4f26-ad93-81a71ea0d7a0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"uniformArray", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"1", ",", 
     RowBox[{"{", 
      RowBox[{"x", ",", "min", ",", "max", ",", "delta"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"y", ",", "min", ",", "max", ",", "delta"}], "}"}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.81126478660415*^9, 3.8112648335512557`*^9}},
 CellLabel->
  "In[668]:=",ExpressionUUID->"407a167b-6195-4979-b454-2c437b750eca"],

Cell["Note that the integral is replaced by delta*Total[].", "Text",
 CellChangeTimes->{{3.81126623688247*^9, 
  3.8112662486595197`*^9}},ExpressionUUID->"86768a79-9ea6-434f-a229-\
6b62726cdfb4"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"absorption", "[", 
    RowBox[{"z0Pix_", ",", "z1Pix_"}], "]"}], ":=", 
   RowBox[{"Exp", "[", 
    RowBox[{"I", "*", 
     RowBox[{"(", 
      RowBox[{"k0p", "/", "2"}], ")"}], "*", "delta", "*", 
     RowBox[{"Total", "[", 
      RowBox[{
       RowBox[{"chiArray", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "All", ",", 
          RowBox[{"z0Pix", ";;", "z1Pix"}]}], "]"}], "]"}], ",", 
       RowBox[{"{", "3", "}"}]}], "]"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.811093410934517*^9, 3.8110934766452074`*^9}, {
  3.811093955045992*^9, 3.8110940000222*^9}, {3.811094050563935*^9, 
  3.811094055157255*^9}, {3.81109427261281*^9, 3.8110942885005913`*^9}, {
  3.811266199287736*^9, 3.811266201732739*^9}},
 CellLabel->
  "In[669]:=",ExpressionUUID->"ba96087c-b79e-47d8-8d71-837505a50a5f"],

Cell[BoxData[
 RowBox[{"Dimensions", "@", "chiArray"}]], "Input",
 CellChangeTimes->{{3.811264941752993*^9, 3.81126494459691*^9}},
 CellLabel->
  "In[670]:=",ExpressionUUID->"67606f48-e6d2-4f90-902f-c54ec6197dba"],

Cell[BoxData[
 RowBox[{"Max", "[", 
  RowBox[{"-", 
   RowBox[{"Log", "[", 
    RowBox[{
     RowBox[{"Abs", "[", 
      RowBox[{
       RowBox[{"absorption", "[", 
        RowBox[{"1", ",", "255"}], "]"}], "*", "uniformArray"}], "]"}], "^", 
     "2"}], "]"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.8112660238356853`*^9, 3.81126604409264*^9}},
 CellLabel->
  "In[671]:=",ExpressionUUID->"266db487-67a8-4028-be64-7e992291bc9f"],

Cell[BoxData[
 RowBox[{"ListPlot", "[", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{"-", 
       RowBox[{"Log", "[", 
        RowBox[{
         RowBox[{"Abs", "[", 
          RowBox[{
           RowBox[{"absorption", "[", 
            RowBox[{"1", ",", "#"}], "]"}], "[", 
           RowBox[{"[", 
            RowBox[{
             RowBox[{"dim", "/", "2"}], ",", 
             RowBox[{"dim", "/", "2"}]}], "]"}], "]"}], "]"}], "^", "2"}], 
        "]"}]}], ")"}], "&"}], "/@", 
    RowBox[{"Range", "[", 
     RowBox[{
      RowBox[{"dim", "/", "4"}], ",", 
      RowBox[{"3", "*", 
       RowBox[{"dim", "/", "4"}]}], ",", 
      RowBox[{"dim", "/", "32"}]}], "]"}]}], ",", 
   RowBox[{
   "PlotLabel", "\[Rule]", "\"\<OD at center stepping through z\>\""}], ",", 
   RowBox[{"Frame", "\[Rule]", "True"}], ",", 
   RowBox[{"FrameLabel", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"\"\<z step [arb. unit]\>\"", ",", "\"\<OD\>\""}], "}"}]}]}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.8112662764836116`*^9, 3.8112664324461117`*^9}, {
  3.811266475137348*^9, 3.8112664756756353`*^9}, {3.811266553943804*^9, 
  3.811266573288682*^9}, {3.811266614289571*^9, 3.8112666465483427`*^9}, {
  3.8112667129707594`*^9, 3.811266757532807*^9}, {3.8112668022288237`*^9, 
  3.8112668447394743`*^9}},
 CellLabel->
  "In[672]:=",ExpressionUUID->"3386a08a-cacb-4414-9eb6-ca1c04fad4a8"],

Cell[BoxData[
 RowBox[{"ArrayPlot", "[", 
  RowBox[{
   RowBox[{"-", 
    RowBox[{"Log", "[", 
     RowBox[{
      RowBox[{"Abs", "[", 
       RowBox[{
        RowBox[{"absorption", "[", 
         RowBox[{"1", ",", 
          RowBox[{"3", "*", 
           RowBox[{"dim", "/", "4"}]}]}], "]"}], "*", "uniformArray"}], "]"}],
       "^", "2"}], "]"}]}], ",", 
   RowBox[{"ColorFunctionScaling", "\[Rule]", "True"}], ",", 
   RowBox[{"ColorFunction", "\[Rule]", 
    RowBox[{"ColorData", "[", "\"\<DarkRainbow\>\"", "]"}]}]}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.811094073431431*^9, 3.811094133637601*^9}, {
   3.8110943020706415`*^9, 3.811094311746333*^9}, {3.811094349396354*^9, 
   3.811094356276883*^9}, {3.8110945816544724`*^9, 3.811094591234809*^9}, 
   3.8112568644126916`*^9, {3.8112578347183847`*^9, 3.811257862183073*^9}, {
   3.8112648174970264`*^9, 3.8112648184554296`*^9}, {3.8112649057135878`*^9, 
   3.811265047349245*^9}, {3.81126519494434*^9, 3.8112652002610106`*^9}, {
   3.8112653749783163`*^9, 3.8112653868973618`*^9}, {3.8112654454450617`*^9, 
   3.811265447535952*^9}, {3.811265479214361*^9, 3.8112655068507743`*^9}, {
   3.811265613164976*^9, 3.8112656423610206`*^9}, {3.8112660630339465`*^9, 
   3.811266133419343*^9}, {3.811267011137911*^9, 3.811267015772455*^9}},
 CellLabel->
  "In[673]:=",ExpressionUUID->"e1722745-eb9e-4e18-9ee0-40f9b92e25ae"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.8110934827740498`*^9, 3.8110935025652275`*^9}},
 CellLabel->
  "In[674]:=",ExpressionUUID->"4a901eee-b9bf-452a-8874-75d82a196c42"],

Cell[BoxData[
 RowBox[{"aArray", "=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"a", "[", 
     RowBox[{"x", ",", "y", ",", "z"}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"x", ",", "3"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"y", ",", "3"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"z", ",", "3"}], "}"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.811093559767614*^9, 3.8110936325007105`*^9}, {
  3.811093740931531*^9, 3.8110937467578125`*^9}, {3.8110937773505225`*^9, 
  3.811093831974228*^9}},
 CellLabel->
  "In[675]:=",ExpressionUUID->"2c11d9cb-1911-44ab-9955-79b8b52c23bc"],

Cell[BoxData[
 RowBox[{"aArray", "[", 
  RowBox[{"[", 
   RowBox[{"All", ",", "All", ",", 
    RowBox[{"1", ";;", "2"}]}], "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.811094004389987*^9, 3.811094028660818*^9}},
 CellLabel->
  "In[676]:=",ExpressionUUID->"908e3e63-d6e9-40e2-81b9-6f2af709ba60"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Total", "[", 
   RowBox[{"aArray", ",", 
    RowBox[{"{", "3", "}"}]}], "]"}], "//", "TableForm"}]], "Input",
 CellChangeTimes->{{3.811093834329095*^9, 3.8110938480531626`*^9}, {
  3.811093925093852*^9, 3.811093944931429*^9}},
 CellLabel->
  "In[677]:=",ExpressionUUID->"f1cf2ae9-1032-4faa-8af2-794892d34f3c"]
}, Open  ]]
},
WindowSize->{721.5, 751.5},
WindowMargins->{{-726, Automatic}, {Automatic, 0}},
TaggingRules->{
 "WelcomeScreenSettings" -> {"FEStarting" -> False}, "TryRealOnly" -> False},
FrontEndVersion->"12.1 for Microsoft Windows (64-bit) (March 18, 2020)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"6dcfce06-0f87-4ea5-8116-4fee70cad646"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 1150, 32, 160, "Input",ExpressionUUID->"f246a61f-5ea7-43ed-8039-4d5b549a7d29"],
Cell[CellGroupData[{
Cell[1733, 56, 160, 3, 66, "Section",ExpressionUUID->"1817c129-b2dc-4352-81a2-d7ccadd73d70"],
Cell[1896, 61, 495, 11, 28, "Input",ExpressionUUID->"11fbab7d-1641-4ff8-a08d-20b3383196f0"],
Cell[2394, 74, 324, 7, 56, "Text",ExpressionUUID->"ed229d32-f038-4273-a958-8813811b0f26"],
Cell[2721, 83, 817, 22, 85, "Input",ExpressionUUID->"13ad70de-88d0-4542-b980-951d9a7b9169"]
}, Open  ]],
Cell[CellGroupData[{
Cell[3575, 110, 156, 3, 66, "Section",ExpressionUUID->"a2a894a5-0bd3-4a00-8b7c-93bed2ea2d9b"],
Cell[3734, 115, 1709, 47, 122, "Input",ExpressionUUID->"d0b11fdd-a5c9-40f6-9c4c-775bbbadb33b"],
Cell[5446, 164, 696, 16, 28, "Input",ExpressionUUID->"9b9244a1-3234-4da3-aae5-dccd97c97fa1"],
Cell[6145, 182, 474, 11, 28, "Input",ExpressionUUID->"b430f5c6-6060-4891-bd74-06de4317fdcf"],
Cell[6622, 195, 540, 9, 78, "Text",ExpressionUUID->"55f73c60-acb4-4a9e-adbb-1b1dfc7473f6"],
Cell[7165, 206, 853, 17, 47, "Input",ExpressionUUID->"128831f8-3bbb-44b8-a075-90bf5b61f24b"],
Cell[8021, 225, 1083, 27, 47, "Input",ExpressionUUID->"9c2f65e6-d85e-4afd-a1dd-6993cc36de78"]
}, Closed]],
Cell[CellGroupData[{
Cell[9141, 257, 156, 3, 52, "Section",ExpressionUUID->"dfe1c6f6-64ef-4632-8167-e634337fa1a5"],
Cell[9300, 262, 2062, 46, 160, "Input",ExpressionUUID->"b6ae6e97-a5d6-40fe-9370-956879952daa"],
Cell[11365, 310, 1696, 35, 66, "Input",ExpressionUUID->"3a649f95-d095-471b-bb7e-261ba8c17efc"],
Cell[13064, 347, 279, 5, 28, "Input",ExpressionUUID->"52681d83-ad74-4542-a746-c0ae4441ef15"],
Cell[13346, 354, 1374, 29, 104, "Input",ExpressionUUID->"c817f662-5b5e-4036-a19a-3a4a9e68a2b1"]
}, Open  ]],
Cell[CellGroupData[{
Cell[14757, 388, 165, 3, 67, "Chapter",ExpressionUUID->"ebcfece4-d757-4304-9540-784119719bcc"],
Cell[14925, 393, 1000, 18, 28, "Input",ExpressionUUID->"3f7c16fb-bebe-455d-8dc8-33428fa0b67a"],
Cell[15928, 413, 1051, 25, 160, "Input",ExpressionUUID->"b60df23a-2a0d-475a-a29d-e0f469c7fbec"],
Cell[16982, 440, 541, 11, 28, "Input",ExpressionUUID->"b2f32056-fa87-41cb-aff4-cfd9daac8822"],
Cell[17526, 453, 316, 7, 28, "Input",ExpressionUUID->"b8fdd1a0-78ed-4154-a4bd-6ea309d1aaa4"]
}, Open  ]],
Cell[CellGroupData[{
Cell[17879, 465, 189, 3, 67, "Chapter",ExpressionUUID->"4e412f85-2869-4b80-a8bc-0fe1517e6d5b"],
Cell[18071, 470, 285, 6, 56, "Text",ExpressionUUID->"6ac2ce8b-702b-49eb-85f3-d36097ebf91d"],
Cell[18359, 478, 1195, 28, 104, "Input",ExpressionUUID->"4d081cd8-00ea-4431-8679-34f6be2ac833"],
Cell[19557, 508, 1045, 23, 47, "Input",ExpressionUUID->"f5667b32-d3de-4dd9-a8ba-f1be2de6b3d5"],
Cell[20605, 533, 916, 18, 28, "Input",ExpressionUUID->"df5b85fe-a851-48a2-a9ac-d52062affbaf"],
Cell[21524, 553, 2591, 71, 216, "Input",ExpressionUUID->"914f1455-1a8d-4cad-8073-a46aa501f017"],
Cell[24118, 626, 245, 5, 28, "Input",ExpressionUUID->"614831fd-ac1b-401f-b001-ca7593aad677"],
Cell[24366, 633, 729, 16, 47, "Input",ExpressionUUID->"1fae7e7f-972c-4e6b-a346-ff12a497a2f8"],
Cell[25098, 651, 249, 5, 28, "Input",ExpressionUUID->"1a28ecdb-a0ab-4659-996a-b775edc73709"],
Cell[25350, 658, 1216, 24, 47, "Input",ExpressionUUID->"dadbe895-2a7c-4e8d-b233-9a5a9bdf89b9"],
Cell[26569, 684, 1297, 26, 66, "Input",ExpressionUUID->"ee60dd30-c5ab-4d42-a371-a99ece33f1f6"],
Cell[27869, 712, 1209, 27, 85, "Input",ExpressionUUID->"c0127f46-06f1-4f6f-a4d7-36b1c4e435a1"],
Cell[29081, 741, 196, 4, 28, "Input",ExpressionUUID->"c3102b0a-3b7f-459b-adbb-f49ce5519a68"],
Cell[29280, 747, 363, 8, 28, "Input",ExpressionUUID->"6dafbc58-cbe8-485c-a39a-40dc8a199daf"],
Cell[29646, 757, 179, 3, 28, "Input",ExpressionUUID->"1dd9d9c9-334e-41d9-95ed-d81dfc69bfda"]
}, Open  ]],
Cell[CellGroupData[{
Cell[29862, 765, 166, 3, 67, "Chapter",ExpressionUUID->"8e55635b-eb9f-4a88-a2ec-ba5b485009b2"],
Cell[30031, 770, 459, 11, 47, "Input",ExpressionUUID->"241007ce-55a5-4f57-a8e0-c91950a2d829"],
Cell[30493, 783, 1860, 53, 141, "Input",ExpressionUUID->"44a719de-cb6e-4bcc-affa-7503033d4ff2"],
Cell[32356, 838, 1370, 36, 104, "Input",ExpressionUUID->"75465931-610e-48ac-ab20-abf1b7f70ac7"],
Cell[33729, 876, 1125, 26, 47, "Input",ExpressionUUID->"e1162aa8-6f1f-4187-b0c4-c3525a41db36"],
Cell[34857, 904, 350, 9, 28, "Input",ExpressionUUID->"f8542fd5-20ec-4f26-ad93-81a71ea0d7a0"],
Cell[35210, 915, 461, 12, 28, "Input",ExpressionUUID->"407a167b-6195-4979-b454-2c437b750eca"],
Cell[35674, 929, 195, 3, 34, "Text",ExpressionUUID->"86768a79-9ea6-434f-a229-6b62726cdfb4"],
Cell[35872, 934, 862, 21, 47, "Input",ExpressionUUID->"ba96087c-b79e-47d8-8d71-837505a50a5f"],
Cell[36737, 957, 213, 4, 28, "Input",ExpressionUUID->"67606f48-e6d2-4f90-902f-c54ec6197dba"],
Cell[36953, 963, 430, 12, 28, "Input",ExpressionUUID->"266db487-67a8-4028-be64-7e992291bc9f"],
Cell[37386, 977, 1394, 37, 66, "Input",ExpressionUUID->"3386a08a-cacb-4414-9eb6-ca1c04fad4a8"],
Cell[38783, 1016, 1375, 28, 47, "Input",ExpressionUUID->"e1722745-eb9e-4e18-9ee0-40f9b92e25ae"],
Cell[40161, 1046, 179, 3, 28, "Input",ExpressionUUID->"4a901eee-b9bf-452a-8874-75d82a196c42"],
Cell[40343, 1051, 602, 16, 28, "Input",ExpressionUUID->"2c11d9cb-1911-44ab-9955-79b8b52c23bc"],
Cell[40948, 1069, 295, 7, 28, "Input",ExpressionUUID->"908e3e63-d6e9-40e2-81b9-6f2af709ba60"],
Cell[41246, 1078, 344, 8, 28, "Input",ExpressionUUID->"f1cf2ae9-1032-4faa-8af2-794892d34f3c"]
}, Open  ]]
}
]
*)

